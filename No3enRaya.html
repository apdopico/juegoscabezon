<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>No3enRaya</title>
  <link rel="icon" type="image/png" href="./Imagenes/faviconCabeza.png">

  <style>
    body {
      background-color: #3d5c5c;
      background-image: url("./Imagenes/imagenFondo.png");
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding-top: 20px;
      color: #fff;
    }

    /* --- CAJAS SUPERIOR E INFERIOR --- */

    .player-box {
      width: 90vw;
      max-width: 420px;
      margin: 0 auto 20px auto;
      background: antiquewhite;
      color: #111;
      border-radius: 14px;
      padding: 10px;
      display: flex;
      align-items: center;
      position: relative;
      box-sizing: border-box;
      border: 2px solid #333;
      min-height: 70px;
    }

    .player-icon {
      width: 50px;
      height: 50px;
      object-fit: contain;
      position: relative;
      z-index: 2;
      transition: all 0.3s ease;
    }

    /* ⭐ NUEVO: resaltado de turno */
    .turn-highlight {
      filter: drop-shadow(0 0 8px gold) brightness(1.2);
      transform: scale(1.15);
    }

    /* Copa a la derecha */
    .crown {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 41px;
      height: 50px;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
    }

    .crown.visible {
      opacity: 1;
    }

    /* Área donde van las fichas */
    .pieces-area {
      flex: 1;
      display: flex;
      flex-wrap: nowrap;
      justify-content: flex-start;
      gap: 6px;
      padding-left: 10px;
    }

    /* Fichas grandes */
    .piece-box {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      transition: opacity 0.3s ease;
    }

    .p1 { background: #ff6b6b; }
    .p2 { background: #4d96ff; }

    /* --- TABLERO --- */
    .board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(5, 1fr);
      margin: 0 auto 20px auto;
      background-color: antiquewhite;
      width: 90vw;
      max-width: 420px;
      aspect-ratio: 1 / 1;
      border: 2px solid #333;
      gap: 6px;
      padding: 6px;
      box-sizing: border-box;
    }

    .cell {
      width: 100%;
      height: 100%;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #444;
      cursor: pointer;
      user-select: none;
      background-color: #fdfdfd;
      position: relative;
      outline: none;
    }

    .cell[aria-disabled="true"] {
      cursor: default;
      opacity: 0.9;
    }

    .piece {
      width: 70%;
      height: 70%;
      border-radius: 50%;
    }

    /* Reiniciar */
    #resetBtn {
      background: none;
      border: none;
      cursor: pointer;
      margin-top: -10px;
    }

    #resetBtn img {
      width: 50px;
      height: 50px;
    }
    @media (max-width: 400px) {
      .piece-box {
      width: 17px;
      height: 17px;
      }
      .player-icon {
      width: 35px;
      height: 35px;
      }
      .player-box {
      padding: 6px;
      }
}

  </style>
</head>
<body>

  <!-- CAJA SUPERIOR IA -->
  <div class="player-box">
    <img id="iconIA" src="Imagenes/IA.png" class="player-icon">
    <img id="crownIA" class="crown" src="Imagenes/iconoCopa.png">

    <div id="iaPieces" class="pieces-area"></div>
  </div>

  <!-- TABLERO -->
  <div id="board" class="board"></div>

  <!-- CAJA INFERIOR JUGADOR -->
  <div class="player-box">
    <img id="iconJugador" src="Imagenes/jugador.png" class="player-icon">
    <img id="crownJugador" class="crown" src="Imagenes/iconoCopa.png">

    <div id="jugadorPieces" class="pieces-area"></div>
  </div>

  <!-- BOTÓN REINICIAR -->
  <button id="resetBtn">
    <img src="Imagenes/reiniciar2.png" alt="Reiniciar">
  </button>


<script>
(function(){

  const SIZE = 5;
  const HUMAN = 1;
  const AI = 2;
  const MAX_PIECES = 12;

  const boardEl = document.getElementById('board');
  const jugadorPiecesEl = document.getElementById('jugadorPieces');
  const iaPiecesEl = document.getElementById('iaPieces');

  const crownJugador = document.getElementById('crownJugador');
  const crownIA = document.getElementById('crownIA');

  const resetBtn = document.getElementById('resetBtn');

  let nextStartingPlayer = AI;
  let board;
  let remaining;
  let currentPlayer;
  let gameOver;

  /* ⭐ NUEVA FUNCIÓN: resaltar turno */
  function updateTurnHighlight() {
    const iconIA = document.getElementById("iconIA");
    const iconJugador = document.getElementById("iconJugador");

    iconIA.classList.remove("turn-highlight");
    iconJugador.classList.remove("turn-highlight");

    if (currentPlayer === AI) {
      iconIA.classList.add("turn-highlight");
    } else {
      iconJugador.classList.add("turn-highlight");
    }
  }

  /* --- Generar líneas ganadoras --- */
  function generateWins(){
    const wins = [];
    const size = SIZE;

    for(let r=0;r<size;r++){
      for(let c=0;c<=size-3;c++)
        wins.push([r*size+c, r*size+c+1, r*size+c+2]);
    }
    for(let c=0;c<size;c++){
      for(let r=0;r<=size-3;r++)
        wins.push([r*size+c, (r+1)*size+c, (r+2)*size+c]);
    }
    for(let r=0;r<=size-3;r++){
      for(let c=0;c<=size-3;c++)
        wins.push([r*size+c, (r+1)*size+(c+1), (r+2)*size+(c+2)]);
    }
    for(let r=0;r<=size-3;r++){
      for(let c=2;c<size;c++)
        wins.push([r*size+c, (r+1)*size+(c-1), (r+2)*size+(c-2)]);
    }
    return wins;
  }

  const WINS = generateWins();

  function init(){
    board = Array(SIZE*SIZE).fill(null);
    remaining = {1: MAX_PIECES, 2: MAX_PIECES};
    currentPlayer = nextStartingPlayer;
    nextStartingPlayer = (nextStartingPlayer===HUMAN ? AI : HUMAN);
    gameOver = false;

    clearCrowns();

    /* CREAR FICHAS SOLO UNA VEZ */
    jugadorPiecesEl.innerHTML = '';
    iaPiecesEl.innerHTML = '';
    for (let i = 0; i < MAX_PIECES; i++) {
      const pj = document.createElement('div');
      pj.className = 'piece-box p1';
      jugadorPiecesEl.appendChild(pj);

      const pa = document.createElement('div');
      pa.className = 'piece-box p2';
      iaPiecesEl.appendChild(pa);
    }

    render();
    updatePieces();

    /* ⭐ Resaltar turno al iniciar */
    updateTurnHighlight();

    if(currentPlayer === AI){
      setTimeout(()=>aiMove(),400);
    }
  }

  function render(){
    boardEl.innerHTML = '';
    for(let i=0;i<SIZE*SIZE;i++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.pos = i;

      if(board[i]!=null){
        const p = document.createElement('div');
        p.className = 'piece ' + (board[i]===HUMAN?'p1':'p2');
        cell.appendChild(p);
        cell.setAttribute('aria-disabled','true');
      } else {
        cell.setAttribute('aria-disabled','false');
        cell.addEventListener('click', onCellClick);
      }

      boardEl.appendChild(cell);
    }
  }

  function onCellClick(e){
    if(gameOver || currentPlayer!==HUMAN) return;
    const pos = Number(this.dataset.pos);
    if(board[pos]!=null || remaining[HUMAN]<=0) return;

    placePiece(pos, HUMAN);
    if(!gameOver){
      setTimeout(()=>aiMove(), 350);
    }
  }

  function placePiece(pos, player){
    board[pos] = player;
    remaining[player]--;

    render();
    updatePieces();

    if(checkThree(player)){
      gameOver = true;
      showCrown(player === HUMAN ? AI : HUMAN);
      return;
    }

    if(remaining[HUMAN]===0 && remaining[AI]===0){
      gameOver = true;
      showCrown('empate');
      return;
    }

    currentPlayer = (player===HUMAN ? AI : HUMAN);

    /* ⭐ Resaltar turno después de jugar */
    updateTurnHighlight();
  }

  function checkThree(player, state = board){
    return WINS.some(line => line.every(i => state[i]===player));
  }

  /* --- Fichas desapareciendo sin moverse --- */
  function updatePieces(){
    jugadorPiecesEl.querySelectorAll('.piece-box').forEach((box, index) => {
      box.style.opacity = index < remaining[HUMAN] ? "1" : "0";
    });
    iaPiecesEl.querySelectorAll('.piece-box').forEach((box, index) => {
      box.style.opacity = index < remaining[AI] ? "1" : "0";
    });
  }

  function clearCrowns(){
    crownJugador.classList.remove('visible');
    crownIA.classList.remove('visible');
  }

  function showCrown(winner){
    clearCrowns();
    if(winner===HUMAN){
      crownJugador.classList.add('visible');
    } else if(winner===AI){
      crownIA.classList.add('visible');
    } else {
      crownJugador.classList.add('visible');
      crownIA.classList.add('visible');
    }
  }

  /* --- IA --- */
  function evaluateBoard(state){
    if(checkThree(AI,state)) return -100;
    if(checkThree(HUMAN,state)) return 100;

    let score=0;
    for(const line of WINS){
      const vals=line.map(i=>state[i]);
      const ai=vals.filter(v=>v===AI).length;
      const hu=vals.filter(v=>v===HUMAN).length;
      const emp=vals.filter(v=>v===null).length;

      if(ai===2 && emp===1) score -= 10;
      if(hu===2 && emp===1) score += 10;
      if(ai===1 && emp===2) score -= 2;
      if(hu===1 && emp===2) score += 2;
    }
    return score;
  }

  function minimax(state, depth, alpha, beta, isMax){
    if(checkThree(AI,state)) return -100+depth;
    if(checkThree(HUMAN,state)) return 100-depth;
    if(depth>=4 || state.every(x=>x!=null)) return evaluateBoard(state);

    if(isMax){
      let best=-Infinity;
      for(let i=0;i<SIZE*SIZE;i++){
        if(state[i]==null){
          state[i]=AI;
          const val=minimax(state,depth+1,alpha,beta,false);
          state[i]=null;
          best=Math.max(best,val);
          alpha=Math.max(alpha,best);
          if(beta<=alpha) break;
        }
      }
      return best;
    } else {
      let best=Infinity;
      for(let i=0;i<SIZE*SIZE;i++){
        if(state[i]==null){
          state[i]=HUMAN;
          const val=minimax(state,depth+1,alpha,beta,true);
          state[i]=null;
          best=Math.min(best,val);
          beta=Math.min(beta,best);
          if(beta<=alpha) break;
        }
      }
      return best;
    }
  }

  function aiMove(){
    if(gameOver || currentPlayer!==AI) return;

    let bestScore=-Infinity, bestMove=null;
    for(let i=0;i<SIZE*SIZE;i++){
      if(board[i]==null){
        board[i]=AI;
        if(!checkThree(AI)){
          const val=minimax(board,0,-Infinity,Infinity,false);
          if(val>bestScore){
            bestScore=val;
            bestMove=i;
          }
        }
        board[i]=null;
      }
    }

    if(bestMove!=null){
      placePiece(bestMove,AI);
    } else {
      const f = board.findIndex(x=>x==null);
      if(f!=-1) placePiece(f,AI);
    }
  }

  resetBtn.addEventListener('click', init);
  init();

})();
</script>
</body>
</html>
